# Use the official Node.js image as base\nFROM node:18-slim\n\n# Install Chrome and dependencies\nRUN apt-get update && apt-get install -y \\\n    wget \\\n    gnupg \\\n    ca-certificates \\\n    procps \\\n    libxss1 \\\n    && wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add - \\\n    && sh -c 'echo \"deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main\" >> /etc/apt/sources.list.d/google.list' \\\n    && apt-get update \\\n    && apt-get install -y google-chrome-stable fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-kacst fonts-freefont-ttf \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Tell Puppeteer to skip installing Chromium\nENV PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true \\\n    PUPPETEER_EXECUTABLE_PATH=/usr/bin/google-chrome-stable\n\n# Create app directory\nWORKDIR /usr/src/app\n\n# Copy package files\nCOPY package*.json ./\n\n# Install app dependencies\nRUN npm ci --only=production && npm cache clean --force\n\n# Copy app source code\nCOPY . .\n\n# Create sessions directory\nRUN mkdir -p sessions && chmod 755 sessions\n\n# Create a non-privileged user\nRUN groupadd -r pptruser && useradd -r -g pptruser -G audio,video pptruser \\\n    && mkdir -p /home/pptruser/Downloads \\\n    && chown -R pptruser:pptruser /home/pptruser \\\n    && chown -R pptruser:pptruser /usr/src/app\n\n# Switch to non-privileged user\nUSER pptruser\n\n# Expose port\nEXPOSE 3000\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \\\n  CMD curl -f http://localhost:3000/health || exit 1\n\n# Start the application\nCMD [\"npm\", \"start\"]